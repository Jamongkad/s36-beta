function Checky(a){this.feed_selection=a.feed_selection;this.check_feed_id=a.check_feed_id;this.category_feed_id=a.category_feed_id;this.click_all=a.click_all;this.checky_bar=a.checky_bar;this.count=0}Checky.prototype.init=function(){var a=this;$(document).delegate(a.feed_selection,"change",function(n){var k=$(this).val();var g=$(a.check_feed_id);var c=$(a.category_feed_id);var l=g.is(":checked");var p=$(location).attr("href");var o=$(this).attr("base-url");var f=$(".checky-bar");var j=new Array();if(l&&k!="none"){var m,i,b;if(k=="restore"||k=="inbox"){m=confirm("Are you sure you want to restore these feedbacks?");i="#fef1b5";b="inbox/all"}if(k=="remove"){m=confirm("Are you sure you want to permanently remove these feedbacks?");i="#fef1b5"}if(k=="publish"){m=confirm("Are you sure want to publish these feedbacks?");i="#66cd00";b="inbox/published/all"}if(k=="feature"){m=confirm("Are you sure want to feature these feedbacks?");i="#fbec5d";b="inbox/featured/all"}if(k=="delete"){m=confirm("Are you sure want to delete these feedbacks?");i="#fef1b5";b="inbox/deleted"}if(m){g.each(function(){if($(this).is(":checked")){if($("#"+$(this).val()).is(":hidden")==false){j.push({feedid:$(this).val(),contactid:$(this).siblings(".contact-feed-id").val(),siteid:$(this).siblings(".site-feed-id").val(),rating:$(this).siblings(".feed-ratings").val()});$("#"+$(this).val()).fadeOut(300,function(){$(this).hide()})}}});var d=j.length;$("option:first",this).prop("selected",true);var h=" <a href='#' class='hide-checkybar'>Close</a>";$.ajax({type:"POST",data:{col:k,feed_ids:j,cat_id:c.val(),curl:p},url:$(this).attr("hrefaction"),dataType:"json",beforeSend:function(){f.html("processing feedback...").css({background:"#fef1b5"}).show()},success:function(r){var q=r.return_ids;var e=r.message;f.css({width:"350px",right:"22%"});f.hide();return_feedback(q,f,k,h,e);if(q==null){f.css({background:i,width:"200px",right:"28%"}).html(notification_message(k,d,q,h)).show()}close_checkybar()}})}$(this).val("none");$(".click-all").attr("checked",false);g.attr("checked",false)}else{$(".click-all").attr("checked",false)}})};Checky.prototype.clickAll=function(){var a=this;$(document).delegate(a.click_all,"click",function(b){if(this.checked){$(a.check_feed_id).prop("checked",true);$(a.click_all).prop("checked",true)}else{$(a.check_feed_id).prop("checked",false);$(a.click_all).prop("checked",false)}})};function notification_message(d,a,c,b){return"<div>"+d+": "+(a-((c!=null)?c.length:0))+(a>1?" feedbacks":" feedback")+b+"</div>"}function return_feedback(e,a,d,c,b){if(e!=null){a.html("<div>"+b+c+"</div>").show();$(e).each(function(f,g){$("div#"+g.feedid+".feedback").fadeIn(300,function(){$(this).show()})})}}function close_checkybar(){$(".hide-checkybar").bind("click",function(a){$(this).parents(".checky-bar").hide();a.preventDefault()})}function DropDownChange(a){this.status_element=a.status_element;this.status_selector=a.status_selector}DropDownChange.prototype.enable=function(){var b=false;var a=this;$(document).delegate(a.status_element,"hover",function(c){if(c.type==="mouseenter"){b=true}else{b=false}});$(document).delegate(a.status_element,"click",function(d){var c=this;$(c).children("span").hide();$(c).children("select").show();$(c).undelegate(a.status_selector).delegate("select",a.status_selector,function(i){var g=$(this);var k=$('option[value="'+g.val()+'"]',this).text();var j=g.val();var f=g.attr("feedid");var h=g.attr("feedurl");$.ajax({type:"POST",url:h,data:{select_val:j,feed_id:f},success:function(){var e=new Status();e.notify("Processing...",1000);g.hide();$(c).children("span").show()}});g.siblings().text(k)});$(document).delegate("body","click",function(f){if(!b){$(c).children("span").show();$(c).children("select").hide()}})})};$.fn.selected_theme=function(a){$(this).on("click",function(d){var c=$(this).attr("id");var b=false;$(this).siblings().each(function(){$(this).removeClass("selected-theme")});if(!b){$(this).addClass("selected-theme")}$(a.set_value).val(c)});return this};jQuery(function(e){var d=".preview-display-widget-button, .preview-form-widget-button";e(d).attr("disabled",true).css({opacity:"0.5"});e(document).delegate("#create-widget","submit",function(l){if(e("input[name=theme_name]",this).val()=="Name of your widget"){alert("Please choose a name for your widget")}else{if(!e('input[value="embedded"]').attr("checked")&&!e('input[value="modal"]').attr("checked")){alert("Please choose a widget type")}else{e(this).ajaxSubmit({dataType:"json",beforeSubmit:function(o,n,m){new Status().notify("Processing...",1000)},success:function(p,q,r,n){e("#widget-preview").show();e("input[name=display_widgetkey]").val(p.display.widget.widgetkey);e("input[name=submit_widgetkey]").val(p.submit.widget.widgetkey);var m=e("input[name=display_widgetkey]").val();var o=e("#preview-widget").attr("hrefaction")+"/"+m;e.ajax({url:o,type:"GET",dataType:"json",success:function(s){e("#widget-generate-view").val(s.html_widget_js_code);e("#iframe-generate-view").val(s.html_iframe_code);new ZClip()}});new Status().notify("Success!",1000);e(d).removeAttr("disabled").css({opacity:"1.0"});e(document).delegate(".preview-display-widget-button","click",function(t){var s=e("#preview-widget").attr("hrefaction")+"/"+m;e.ajax({url:s,type:"GET",dataType:"json",success:function(u){s36Lightbox(u.width,u.height,u.html_view)}});t.preventDefault()})}})}}l.preventDefault()});e(document).delegate("#create-form-widget","submit",function(l){e(this).ajaxSubmit({dataType:"json",beforeSubmit:function(o,n,m){new Status().notify("Processing...",1000)},success:function(p,q,r,o){var m=p.submit.widget.widgetkey;var n=e("#formcode-manager-url").attr("hrefaction")+"/"+m;e("#widget-preview").show();new Status().notify("Success!",1000);e.ajax({url:e("#preview-widget").attr("hrefaction")+"/"+m,type:"GET",dataType:"json",success:function(s){window.location=n}})}});l.preventDefault()});e(document).delegate(".preview-form-widget-button, div#preview.button-gray","click",function(o){var n=e("#preview-form-widget-url").attr("hrefaction");var l=e("#selected-form").val();var m=n+"/"+l;e.ajax({url:m,data:{submit_form_text:e("input[name=submit_form_text]").val(),submit_form_question:e("textarea[name=submit_form_question]").val()},dataType:"json",success:function(p){s36Lightbox(p.width,p.height,p.html_view)}});o.preventDefault()});e("#full_page_widget").hide();e("#embed_widget").hide();e("#modal_widget").hide();e("#full_page_type").click(function(){a();e("#embed_widget tr td").children('select, input[type="text"]').val(0).end().children('input[type="radio"]').attr("checked",null);e("#modal_widget tr td").children("select").val(0)});e("#embed_type").click(function(){c();e("#full_page_widget tr td").children("select").val(0);e("#modal_widget tr td").children("select").val(0)});e("#modal_type").click(function(){h();e("#full_page_widget tr td").children("select").val(0);e("#embed_widget tr td").children('select, input[type="text"]').val(0).end().children('input[type="radio"]').attr("checked",null)});if(e('input[value="embedded"]').attr("checked")){c()}if(e('input[value="modal"]').attr("checked")){h()}function a(){e("#full_page_widget").slideDown();e("#embed_widget").slideUp();e("#modal_widget").slideUp()}function c(){e("#full_page_widget").slideUp();e("#embed_widget").slideDown();e("#modal_widget").slideUp()}function h(){e("#full_page_widget").slideUp();e("#embed_widget").slideUp();e("#modal_widget").slideDown()}e("#edit-widget-btn").on("click",function(l){e.scrollTo(".widget-options:first-child",800);l.preventDefault()});var k=e("#overview-target, #display-overview-target, #form-overview-target");k.delegate(".pagination a","click",function(n){var l=e(this).attr("href");var m=e(this);e.ajax({url:l,dataType:"json",beforeSend:function(p){var o=new Status();o.notify("Processing...",1000)},success:function(o){m.parents("span").html(o.view)}});n.stopImmediatePropagation();n.preventDefault()});var j=e(".form-designs").cycle({fx:"scrollHorz",speed:500,timeout:0,pause:1,next:".form-design-next",prev:".form-design-prev"});j.cycle(expose_index("#selected-form"));var f=["r","l","br","bl","tr","tl"];var b="";$tab_slide=[];for(pos=0;pos<=f.length;pos++){b=f[pos];$tab_slide[b]=e("."+b+"-designs").cycle({fx:"scrollHorz",speed:500,timeout:0,pause:1,next:"."+b+"-design-next",prev:"."+b+"-design-prev"})}var g=expose_index("#selected-tab");j.cycle(expose_index("#selected-form"));var i=e("#tab-position").val();$tab_slide[i].cycle(g);e("#tab-slider").children().each(function(){e(this).hide()});e("."+i+"-design-slide").show();e("#tab-position").change(function(){var l=e(this).val();e("#tab-slider").children().each(function(){e(this).hide()});e("."+l+"-design-slide").show()});e(".form-design").selected_theme({set_value:"#selected-form"});e(".tab-design").selected_theme({set_value:"#selected-tab"}).click(function(o){var n=e(this).attr("id");var m=e("input[name=submit_widgetkey]").val();var l=e("#update-tabtype-url").attr("hrefaction")+"/"+m+"/"+n;e.ajax({url:l,beforeSend:function(){new Status().notify("Processing...",1000)},success:function(p){new Status().notify("Success!",1000)}});o.preventDefault()});e(document).delegate(".delete-widget","click",function(n){var l=e(this).attr("href");var m=e(this).parents("div.widget-types");if(confirm("Are you sure you want to delete this widget?")){e.ajax({url:l,success:function(o){m.fadeOut(500,function(){e(this).remove()})}})}n.preventDefault()});e(".large-text, .regular-text").focus(function(l){if(e(this).val()==e(this)[0].title){e(this).removeClass("reg-text-active");e(this).val("")}});e(".large-text, .regular-text").blur(function(){if(e.trim(e(this).val())==""){e(this).val(e(this)[0].title)}});e(".large-textarea, .regular-textarea, .form-text, .large-text").each(function(){e(this).val(e(this)[0].title)})});function expose_index(a){var c=$(a).val();var d=$("#"+c).parent();var b=parseInt(d.index());$("#"+c).addClass("selected-theme");return b}function isDefined(d,c){if(typeof d!="object"||d==null){return false}var b=c.split(".");while(b.length){var a=b.shift();if(!(a in d)){return false}d=d[a]}return true}jQuery(function(a){a('select[name="date-filter"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("date",a(this).val())}});a('select[name="priority-filter"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("priority",a(this).val())}});a('select[name="status-filter"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("status",a(this).val())}});a('select[name="rating-limit"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("rating",a(this).val())}});a('select[name="feedback-limit"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("limit",a(this).val())}});a('select[name="category-filter"]').bind("change",function(b){if((a(this).val()=="default")){window.location=window.location.pathname}else{insertParam("category",a(this).val())}});a('select[name="site_choice"]').bind("change",function(c){var b=a(this).val();window.location=(b=="all")?"all":"?site_id="+a(this).val()})});function insertParam(d,e){d=escape(d);e=escape(e);var b=document.location.search.substr(1).split("&");if(b==""){document.location.search="?"+d+"="+e}else{var c=b.length;var a;while(c--){a=b[c].split("=");if(a[0]==d){a[1]=e;b[c]=a.join("=");break}}if(c<0){b[b.length]=[d,e].join("=")}document.location.search=b.join("&")}}function InboxStateObject(){this.baseUrl=$("input[name='baseUrl']").val()}InboxStateObject.prototype.undo=function(){var a=this;$(document).delegate("a.undo","click",function(h){var c=$(this).attr("href");var d=$(this).attr("hrefaction");var b=$(this).attr("undo-type");var f=$(".inbox-state").val();var i=a.elem.attr("catid");var g=350;$("#"+a.feeds.feedid).fadeIn(g);$(this).parents("."+b).fadeOut(g,function(){$(this).remove()});$.ajax({type:"POST",url:d,data:{mode:f,feed_ids:[a.feeds],cat_id:i,catstate:true},success:function(){var e=new Status();e.notify("Processing...",1000)}});h.preventDefault()})};InboxStateObject.prototype.process=function(){var a=this;var b=$(a).attr("feedid");if(b){$(a.elem).parents(".feedback").fadeOut(350,function(){var d="  <a class='undo' hrefaction='"+a.href+"' href='#' undo-type='"+a.identifier+"'>Undo</a>";var f="  <a class='close-checky' href='#'>Close</a>";var c=a.message+d+f;var e=$("<div/>").addClass(a.identifier).html(c);var g=$(".checky-bar");if(a.state==0){$.ajax({type:"POST",url:a.href,data:{mode:a.mode,feed_ids:[a.feeds],cat_id:a.catid,catstate:a.catstate},success:function(){g.html(e).show();var h=new Status();h.notify("Processing...",1000)}})}else{$.ajax({type:"POST",url:a.href,data:{mode:"inbox",feed_ids:[a.feeds],cat_id:a.catid},success:function(){g.html("<div class='"+a.identifier+"'>Feedback has been sent to the <a href='"+a.baseUrl+"inbox/all'>Inbox</a> "+d+f+"</div>").show();var h=new Status();h.notify("Processing...",1000)}})}})}$(document).delegate("a.close-checky","click",function(c){$(this).parents(".check").remove();c.preventDefault()})};function CheckStateObject(a){InboxStateObject.apply(this,arguments);this.elem=a;this.message="Feedback has been published and moved to <a href='"+this.baseUrl+"inbox/published/all'>Published Folder</a>";this.mode="publish";this.feedid=$(a).attr("feedid");this.href=$(a).attr("hrefaction");this.catid=$(a).attr("catid");this.catstate=$(a).attr("cat-state");this.state=$(a).attr("state");this.feeds={feedid:this.feedid};this.identifier=$(a).attr("class")}CheckStateObject.prototype=new InboxStateObject();function FeatureStateObject(a){InboxStateObject.apply(this,arguments);this.elem=a;this.message="Feedback has been published and moved to <a href='"+this.baseUrl+"inbox/featured/all'>Featured Folder</a>";this.mode="feature";this.feedid=$(a).attr("feedid");this.href=$(a).attr("hrefaction");this.catid=$(a).attr("catid");this.catstate=$(a).attr("cat-state");this.state=$(a).attr("state");this.feeds={feedid:this.feedid};this.identifier=$(a).attr("class")}FeatureStateObject.prototype=new InboxStateObject();function RemoveStateObject(a){InboxStateObject.apply(this,arguments);this.elem=a;this.message="Feedback has been <a href='"+this.baseUrl+"inbox/deleted'>deleted</a>";this.mode="delete";this.feedid=$(a).attr("feedid");this.href=$(a).attr("hrefaction");this.catid=$(a).attr("catid");this.catstate=$(a).attr("cat-state");this.state=$(a).attr("state");this.feeds={feedid:this.feedid};this.identifier=$(a).attr("class")}RemoveStateObject.prototype=new InboxStateObject();function CatPickObject(a){InboxStateObject.apply(this,arguments);this.elem=a;this.catstate=$(a).attr("cat-state");if(this.catstate=="default"){this.message="Feedback has been sent to <a href='"+this.baseUrl+"inbox/all'>Inbox</a>"}else{this.message="Feedback has been sent to <a href='"+this.baseUrl+"inbox/filed/all'>Filed Feedback</a>"}this.mode="fileas";$(a).parents("div.category-picker-holder").hide();this.feedid=$(a).attr("feedid");this.href=$(a).attr("hrefaction");this.catid=$(a).attr("catid");this.catstate=$(a).attr("cat-state");this.state=$(a).attr("state");this.feeds={feedid:this.feedid};this.identifier=$(a).attr("class")}CatPickObject.prototype=new InboxStateObject();CatPickObject.prototype.process=function(){var a=this;if(location.pathname.match(/filed|modifyfeedback/)){$.ajax({type:"POST",url:a.href,data:{mode:a.mode,feed_ids:[a.feeds],cat_id:a.catid,catstate:a.catstate},success:function(){if(a.catstate=="default"){$(a.elem).parents(".feedback").fadeOut(350)}var b=new Status();b.notify("Processing...",1000)}})}else{$(this.elem).parents(".feedback").fadeOut(350,function(){var c=" <a class='undo' hrefaction='"+a.href+"' href='#' undo-type='"+a.identifier+"'>Undo</a>";var e="  <a class='close-checky' href='#'>Close</a>";var b=a.message+c+e;var d=$("<div/>").addClass(a.identifier).html(b);var f=$(".checky-bar");if(a.state==0){$.ajax({type:"POST",url:a.href,data:{mode:a.mode,feed_ids:[a.feeds],cat_id:a.catid,catstate:a.catstate},success:function(){var g=new Status();g.notify("Processing...",1000);f.html(d).show()}})}else{$.ajax({type:"POST",url:a.href,data:{mode:"inbox",feed_ids:[a.feeds],cat_id:a.catid},success:function(){var g=new Status();g.notify("Processing...",1000);f.html("<div class='"+a.identifier+"'>Feedback has been sent to the <a href='"+a.baseUrl+"inbox/all'>Inbox</a> "+c+e+"</div>").show()}})}})}$(document).delegate("a.close-checky","click",function(b){$(this).parents(".check").remove();b.preventDefault()})};function InboxStatusChange(a){this.inbox_controls=a}InboxStatusChange.prototype.initialize=function(){var a=this;$(document).delegate(a.inbox_controls,"click",function(h){var d=$(this).attr("class");var g=$(this);var d=$(this).attr("class");var g=$(this);if(d=="check"){var c=new CheckStateObject(g);c.process();c.undo()}if(d=="feature"){var f=new FeatureStateObject(g);f.process();f.undo()}if(d=="remove"||d=="popup-delete"){var b=new RemoveStateObject(g);b.process();b.undo()}})};jQuery(function(d){d("abbr.timeago").timeago();d(document).delegate(".feedback-avatar","hover",function(l){if(l.type==="mouseenter"){d(".large-avatar",this).show()}else{d(".large-avatar",this).hide()}});d(document).delegate("a.cat-picks","click",function(n){var l=false;d(this).parent().siblings().children("a").each(function(){d(this).removeClass("Matched")});if(!l){d(this).addClass("Matched")}var m=new CatPickObject(d(this));m.process();m.undo();n.preventDefault()});d(document).delegate("a.menubtn","click",function(m){var l=false;d(this).parent().children("a.menubtn").each(function(){d(this).removeClass("matched")});if(!l){d(this).addClass("matched")}d.ajax({type:"GET",url:d(this).attr("href"),success:function(o){var n=new Status();console.log("mathew");n.notify("Processing...",10000)}});m.preventDefault()});d(document).delegate("a.flagged","click",function(n){d(this).toggleClass("matched");var l=d(this).attr("state");var m;if(l==0){d(this).attr("state",1);m=1}else{d(this).attr("state",0);m=0}d.ajax({type:"GET",data:{state:m},url:d(this).attr("href"),success:function(p){var o=new Status();o.notify("Processing...",1000)}});n.preventDefault()});d(document).delegate("a.delete","click",function(l){if(confirm("Are you sure you want to delete this feedback?")){return true}l.preventDefault()});d(".reply").bind("click",function(m){var l=d(this).attr("hrefaction");window.location=l;m.preventDefault()});var a={};d(".add-bcc > li").bind("click",function(m){var o=d(this).index();var l="<input type='text' name='bcc[]' value='"+d(this).text()+"' />  <a class='delete-bcc' id='"+o+"' href='#'>[x]</a>";var n=d("#first-bcc");if(n.val().length===0){n.val(d(this).text());a[o]=true}else{if(typeof a[o]=="undefined"){d("#bcc-target").append(l);a[o]=true}}d(".delete-bcc").unbind("click.delete-bcc").bind("click.delete-bcc",function(q){var p=d(this).attr("id");d(this).prev("input").remove().end().remove();delete a[p];q.preventDefault()});m.preventDefault()});d("#themeId_1 input:radio").attr("checked",true);d(".ff-form").hide();var f=false;d(".contact, .fileas, .forward").hover(function(){f=true},function(){f=false});d(document).delegate(".fileas","click",function(l){var m=d(this).attr("id");d("#"+m+" div.category-picker-holder").show().hover(function(){f=true},function(){f=false});l.preventDefault()});d('textarea[name="email_comment"]').bind("focus",function(){d(this).val("")});d(document).delegate(".contact, .forward","click",function(n){var o=d(this).attr("id");var l;var m=d(this).attr("class");if(m=="contact"){l=d("#"+o+" div.fast-forward-holder")}if(m=="forward"){l=d("#"+o)}l.show().hover(function(){d("div.email-list > ul.email-picker li[id^=email]",this).live("click",function(){var p=d(this);p.parent().hide().siblings(".ff-form").ajaxForm({success:function(){p.parents("div.fast-forward-holder").hide().end().parents(".email-picker").show().end().parent().siblings(".ff-form").hide().children(".ff-forward-to").html("").end();d('textarea[name="email_comment"]').val("");alert("Fast-forward sent to "+d("a",p).text())}}).children(".ff-forward-to").html(d(this).html()).end().children('input[name="email"]').val(d("a",this).html()).end().show()});f=true},function(){f=false});n.preventDefault()});d("body").click(function(){if(!f){d("div.fast-forward-holder, div.category-picker-holder, .ff-form").hide();d(".email-picker").show();d('textarea[name="email_comment"]').val("")}});new InboxStatusChange(".check, .feature, .remove, .popup-delete").initialize();d("div.undo-bar").hide();d(".flag").switcharoo("-100px 0px");d.each(d("ul#nav-menu li"),function(l,m){d(m).bind("click",function(n){window.location=d(this).children("a").attr("href")})});var b=new Checky({feed_selection:".feed-selection",check_feed_id:".check-feed-id",category_feed_id:".category-feed-id",click_all:".click-all"});b.init();b.clickAll();var e=new DropDownChange({status_element:"span.status-change",status_selector:"change.status"});e.enable();var k=new DropDownChange({status_element:"span.priority-change",status_selector:"change.priority"});k.enable();d(".check").fancytips();d(".fileas").fancytips();d(".reply").fancytips();d(".feature").fancytips();d(".contact").fancytips();d(".flag").fancytips();d(".remove").fancytips({top:45});d("a.perm-delete").click(function(l){if(confirm("Are you sure you want to permanently delete this feedback?")){return true}l.preventDefault()});h();d("a.add-new-ctgy").bind("click",function(n){var m=d("input[name='category_nm']");var l=d("#ctgy-list");if(m.val()==false){alert("Category Name cannot be blank.")}else{d.ajax({url:l.attr("hrefaction"),type:"POST",data:{ctgy_nm:m.val(),companyId:d("input[name='companyid']").val()},success:function(o){l.append(o);m.val("");h()}})}n.preventDefault()});function h(){d("a.rename-ctgy, a.delete-ctgy").unbind("click.ctgy-controls").bind("click.ctgy-controls",function(o){var n=d(this).attr("class");var m=d(this);if(n=="rename-ctgy"){var l=d('<input type="text" name="ctgy_nm"/>').val(m.parents("div").siblings("div").children(".ctgy-name").html());if(m.text()=="Update"){var q=d('input[name="ctgy_nm"]').val();console.log("Rename");m.text("Rename").parents("div").siblings("div").children(".ctgy-name").html(q).end().end().end();d.ajax({url:m.attr("href"),type:"POST",data:{ctgy_nm:q}})}else{m.text("Update").parents("div").siblings("div").children(".ctgy-name").html(l).end().end().end()}}if(n=="delete-ctgy"){var p=m.parents("div.grids");if(confirm("Are you sure you want to delete this category? There is no undo.")){d.ajax({url:d(this).attr("href"),success:function(r){p.fadeOut()}})}}o.preventDefault()})}var i,j;function c(){d("#jcrop_target").Jcrop({setSelect:["40","20","190","170"],boxWidth:350,boxHeight:230,aspectRatio:1,onChange:g,onSelect:g},function(){i=this})}function g(o){var q=100/o.w;var n=100/o.h;var p=d("#jcrop_target");var m=p.height();var l=p.width();d("#x").val(o.x);d("#y").val(o.y);d("#w").val(o.w);d("#h").val(o.h);d("#preview").css({width:Math.round(q*l)+"px",height:Math.round(n*m)+"px",marginLeft:"-"+Math.round(q*o.x)+"px",marginTop:"-"+Math.round(n*o.y)+"px"})}d("div.adjust-crop").hide();d(document).delegate("#your_photo","change",function(){d.ajaxFileUpload({url:d("#ajax-upload-url").attr("hrefaction"),secureuri:false,fileElementId:"your_photo",dataType:"json",success:function(r,l){var m=new Status();m.notify("Photo Upload Success!",1000);var o="/"+r.dir;var q=Math.round(r.wid);var p=d("div.jcrop_div");var n=d('input[name="existing_avatar"]');d("div.adjust-crop").show();d("#profile_picture").attr("src",o);d("#jcrop_target").attr("src",o);d("#preview").attr("src",o);if(i){i.setImage(d("#profile_picture").attr("src"));i.setSelect(["40","20","190","170"])}if(n.length>0){d.post(d("#ajax-delete-existing-avatar").attr("hrefaction"),{avatar:n.val()})}p.css({width:q});d('input[name="orig_image_dir"]').val(o);c()}})});d("#cropbtn").click(function(){var l=d("#x").val();var s=d("#y").val();var q=d("#w").val();var o=d("#h").val();var m=d("#preview").attr("src");var n=d("#crop_status");var p=d("#cropped_photo").val();var r={src:m,x_coords:l,y_coords:s,wd:q,ht:o,oldphoto:p,login_type:36};n.html(" Cropping Photo...");d.ajax({url:d("#ajax-crop-url").attr("hrefaction"),type:"POST",data:r,success:function(u){d("#cropped_photo").val(u);d("#profile_picture").attr("src","/uploaded_cropped/150x150/"+u);var t=new Status();t.notify("Your photo is successfully cropped! If you feel this is the right photo for you please click on the Save Settings button.",4000);n.hide();d("div.adjust-crop").hide()}})});d(document).delegate("a.save","click",function(n){var l=d(".feedback-textarea");var o=l.attr("hrefaction");var m=d("#feed-id").val();d.post(o,{feed_id:m,feedback_text:l.val()},function(q){var p=new Status();p.notify("Processing...",1000)});n.preventDefault()});d("a.admin-delete").bind("click",function(l){if(confirm("Are you sure you want to delete this user? There is no undo.")){return true}l.preventDefault()});d(".contact-edit").bind("click",function(m){var l=d(this).attr("hrefaction");window.location=l;m.preventDefault()});d(".contact-delete").bind("click",function(m){var n=d(this).attr("hrefaction");var l=this;if(confirm("Are you sure you want to delete this user? There is no undo.")){d.get(n,function(o){d(l).parents("tr").fadeOut(350)})}m.preventDefault()});d(".copycheck").hide();d("#widget-preview").hide();new ZClip()});function s36Lightbox(d,b,a){if(jQuery("#lightbox").size()==0){var c=jQuery('<div id="lightbox"></div>');var f=jQuery('<div id="lightbox-shadow"/>');jQuery(f).click(function(g){closeLightbox()});jQuery("body").append(f);jQuery("body").append(c)}jQuery("#lightbox").empty();if(a!=null){jQuery("#lightbox").append(a+"<div id='lightbox-comment' style='color:#fff;position:absolute;top:-20px;right:10px;'>This is a preview only | <span style='cursor:pointer'>close</span></div>")}jQuery("#lightbox-comment").click(function(g){closeLightbox()});var e=Math.round(d/2);jQuery("#lightbox").css("top",jQuery(window).scrollTop()+50+"px");jQuery("#lightbox").css({width:d,height:b,"margin-left":"-"+e+"px"});jQuery("#lightbox").fadeIn("fast");jQuery("#lightbox-shadow").fadeIn("fast")}function closeLightbox(){jQuery("#lightbox").fadeOut("fast",function(){jQuery(this).empty()});jQuery("#lightbox-shadow").fadeOut("fast")}function Status(){this.message="#notification-message";this.notification="#notification"}Status.prototype.notify=function(c,a){var b=this;var a=a;$(b.message).empty().html(c).show();$(b.notification).animate({height:"50",opacity:"100"},"fast","",function(){if(a){setTimeout(function(){$(b.notification).animate({height:0,opacity:0},"fast")},a)}})};function ZClip(){$("#copy-widget-js").zclip({path:"/js/ZeroClipboard.swf",copy:$("#widget-generate-view").val(),beforeCopy:function(){$("#widget-generate-view").siblings(".copycheck").fadeIn()},afterCopy:function(){$("#widget-generate-view").siblings(".copycheck").fadeOut(1000)}});$("#copy-widget-iframe").zclip({path:"/js/ZeroClipboard.swf",copy:$("#iframe-generate-view").val(),beforeCopy:function(){$("#iframe-generate-view").siblings(".copycheck").fadeIn()},afterCopy:function(){$("#iframe-generate-view").siblings(".copycheck").fadeOut(1000)}})};